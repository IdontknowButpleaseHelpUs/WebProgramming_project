<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Login</title>
   <link rel="stylesheet" href="login.css">
</head>

<body>
   <div class="header">
      <img src="../assets/menu.png" alt="menu logo" class="menu-logo">
      <div class="right-header-items">
         <a class="go-back-button" href="../page1.html">Go Back</a>
         <img src="../assets/user.png" alt="pfp picture" class="pfp">
         <img src="../assets/down-arrow.png" alt="drop down arrow" class="drop-down">
      </div>
   </div>

   <div class="compulsory">
      <img src="../assets/SE_logo.png" alt="logo" class="logo">
      <p class="compulsory-text">
         <span>S</span>oftware
         <span style="color: rgb(255, 111, 0); text-shadow: 2px 2px 5px rgb(0, 0, 0);">E</span>ngineering
      </p>
   </div>

   <div class="container">
      <div class="login-container">
         <h2>Login</h2>
         <form id="loginForm">
            <input type="text" id="username" placeholder="Username" required>
            <input type="password" id="password" placeholder="Password" required>
            <button type="submit">Login</button>
         </form>
         <p id="status"></p>
      </div>
   </div>

   <script>
      const form = document.getElementById('loginForm');
      const status = document.getElementById('status');

      form.addEventListener('submit', async (e) => {
         e.preventDefault();

         const username = document.getElementById('username').value;
         const password = document.getElementById('password').value;

         try {
            const res = await fetch('http://127.0.0.1:5000/api/login', {
               method: 'POST',
               headers: { 'Content-Type': 'application/json' },
               body: JSON.stringify({ username, password })
            });

            const data = await res.json();

            if (data.success) {
               status.textContent = data.message;
               status.style.color = 'green';

               localStorage.setItem("loggedUser", JSON.stringify({
                  username,
                  role: data.role,
                  name: data.name || username, 
                  courses: data.courses || []  
               }));
               console.log(`Logged in as ${data.role}`);
               setTimeout(() => {
                  if (data.role === "admin") {
                     window.location.href = "../admin/admin.html";
                  } else if (data.role === "student") {
                     window.location.href = "../student/userDashboard.html";
                  } else if (data.role === "lecturer") {
                     window.location.href = "../lecturer/lecturerDashboard.html";
                  }
               }, 1000);
            } else {
               status.textContent = data.message;
               status.style.color = 'red';
            }
         } catch (err) {
            status.textContent = "Server error";
            status.style.color = 'red';
         }
      });
   </script>
</body>

</html>