<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1" />
   <title>User Dashboard</title>
   <link rel="stylesheet" href="../style.css" />
</head>

<body>
   <div class="container">
      <div class="header">
         <img src="../assets/menu.png" alt="menu logo" class="menu-logo">
         <div class="right-header-items">
            <span id="welcomeUser" style="margin-right: 10px; font-weight: bold;">Welcome, Dumbass!</span>
            <img src="../assets/user.png" alt="pfp picture" class="pfp">
            <img src="../assets/down-arrow.png" alt="drop down arrow" class="drop-down" id="dropdown">
         </div>
      </div>

      <div class="compulsory">
         <img src="../assets/SE_logo.png" alt="logo" class="logo">
         <p class="compulsory-text"><span>S</span>oftware <span
               style="color: rgb(255, 111, 0); text-shadow: 2px 2px 5px rgb(0, 0, 0);">E</span>ngineering</p>
      </div>

      <div class="dropdown-content" id="dropdown-content">
         <a href="#" class="logout">Log out</a>
         <a href="#" class="setting">Settings</a>
      </div>

      <div class="main-section">
         <div class="search-bar">
            <input type="text" placeholder="Search for courses..." id="courseSearch" />
            <button id="searchBtn">Search</button>
         </div>

         <p id="course-title">My Courses</p>
         <div class="course-grid" id="courseGrid"></div>
      </div>

      <div class="footer">
         <div class="footer-content">
            <div class="contact-us">
               <h4>Contact Us</h4>
               <ul>
                  <li>Line: <a href="https://line.me/ti/p/your-line-id" target="_blank" rel="noopener">your-line-id</a>
                  </li>
                  <li>Phone: <a href="tel:+66000000000">+66 0000 0000</a></li>
                  <li>Email: <a href="mailto:example@gmail.com">example@gmail.com</a></li>
               </ul>
            </div>

            <div class="location">
               <h4>Location</h4>
               <p>
                  <li>
                     สำนักงานบริหารวิชาการและคุณภาพการศึกษา<br>
                     อาคาร 6 ชั้น 3 สจล.<br>
                     แขวงลาดกระบัง เขตลาดกระบัง<br>
                     กรุงเทพมหานคร 10520
                  </li>
               </p>
            </div>

            <div class="get-social">
               <h4>Get Social</h4>
               <div class="social-icons">
                  <a href="https://www.facebook.com/kmitlofficial" target="_blank" rel="noopener" aria-label="Facebook">
                     <img src="../assets/facebook.png" alt="Facebook" />
                     <span>KMITL</span>
                  </a>
                  <a href="https://x.com/Kmitlofficial" target="_blank" rel="noopener" aria-label="Twitter">
                     <img src="../assets/twitter.png" alt="Twitter" />
                     <span>KMITL</span>
                  </a>
                  <a href="https://www.instagram.com/kmitlofficial" target="_blank" rel="noopener"
                     aria-label="Instagram">
                     <img src="../assets/instagram.png" alt="Instagram" />
                     <span>kmitlofficial</span>
                  </a>
               </div>
            </div>
         </div>
         <hr />
         <p class="footer-bottom-text">
            Copyright © 2020 - Developed by สำนักงานบริหารวิชาการและคุณภาพการศึกษา. Powered by Moodle
         </p>
      </div>

   </div>

   <script>
      document.addEventListener("DOMContentLoaded", function () {

         document.querySelector(".menu-logo").addEventListener("click", function () {
            this.style.filter = this.style.filter === "" ? "invert(100%)" : "";
            this.style.transform = this.style.transform === "" ? "rotate(-90deg)" : "";
         });

         document.querySelector(".drop-down").addEventListener("click", function () {
            this.style.filter = this.style.filter === "" ? "invert(100%)" : "";
            this.style.transform = this.style.transform === "" ? "rotate(-180deg)" : "";
         });

         const dropdown = document.getElementById('dropdown');
         const dropdownContent = document.getElementById('dropdown-content');

         dropdown.addEventListener('click', (e) => {
            e.preventDefault();
            dropdownContent.classList.toggle('show');
         });

         document.querySelector('.logout').addEventListener('click', (e) => {
            e.preventDefault();
            localStorage.removeItem("loggedUser");
            setTimeout(() => window.location.href = '../login/login.html', 500);
         });

         document.querySelector('.setting').addEventListener('click', (e) => {
            e.preventDefault();
            window.location.href = '../setting/setting.html';
         });

         const loggedUser = JSON.parse(localStorage.getItem("loggedUser"));

         if (!loggedUser) {
            alert("Login first!");
            window.location.href = "../login/login.html";
         }

         document.getElementById("welcomeUser").textContent = `Welcome, ${loggedUser.username}!`;

         const courseGrid = document.getElementById("courseGrid");

         fetch("http://127.0.0.1:5000/api/courses")
            .then(res => res.json())
            .then(allCourses => {
               const userCourses = allCourses.filter(course => loggedUser.courses.includes(course.courseid));

               if (userCourses.length === 0) {
                  courseGrid.innerHTML = "<p>You have no courses assigned!</p>";
                  return;
               }

               userCourses.forEach(course => {
                  const card = document.createElement("div");
                  card.classList.add("course-card");

                  const header = document.createElement("div");
                  header.classList.add("course-card-header");

                  const topColor = `rgba(${Math.floor(Math.random() * 256)}, ${Math.floor(Math.random() * 256)}, ${Math.floor(Math.random() * 256)}, 0.4)`;
                  const bottomColor = `rgba(${Math.floor(Math.random() * 256)}, ${Math.floor(Math.random() * 256)}, ${Math.floor(Math.random() * 256)}, 0.4)`;

                  const overlay = document.createElement("div");
                  overlay.classList.add("course-card-overlay");
                  overlay.style.background = `linear-gradient(to bottom, ${topColor}, ${bottomColor})`;

                  const title = document.createElement("h3");
                  title.textContent = course.title;

                  const courseId = document.createElement("span");
                  courseId.classList.add("course-id");
                  courseId.textContent = course.courseid;

                  header.appendChild(overlay);
                  header.appendChild(title);
                  header.appendChild(courseId);

                  const description = document.createElement("p");
                  description.textContent = course.description;

                  card.appendChild(header);
                  card.appendChild(description);

                  courseGrid.appendChild(card);

                  card.addEventListener("click", function () {
                     const courseTitle = encodeURIComponent(course.title);
                     const courseId = encodeURIComponent(course.courseid);
                     window.location.href = `../course/view.html?id=${courseId}`;
                  });
               });
            })
            .catch(err => console.error("Failed to fetch courses, dumbass:", err));

         document.getElementById("searchBtn").addEventListener("click", () => {
            const searchTerm = document.getElementById("courseSearch").value.toLowerCase();
            document.querySelectorAll(".course-card").forEach(card => {
               const title = card.querySelector("h3").textContent.toLowerCase();
               card.style.display = title.includes(searchTerm) ? "block" : "none";
            });
         });
      });
   </script>
</body>

</html>